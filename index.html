<html>
<head>
  <style type="text/css">
    p#feedback { background-color:yellow; }
    p#feedback.success { background-color:green; }
    p#feedback.error { background-color:red; }
    #online-users { display:none; }
  </style>
  <script src="jquery-1.4.2.min.js" type="text/javascript"></script>
  <script type="text/javascript">
  var conn, connect;
  connect = function() {
    if (window["WebSocket"]) {
      conn = new WebSocket("ws://localhost:8124");
      conn.onmessage = function (evt) {
        var message = JSON.parse(evt.data);
        if (message['error']) {
          $("p#feedback").attr("class", "error").text(message['error']);
        } if (message['success']) {
          $("p#feedback").attr("class", "success").text(message['success']);
          if (message['login']) {
            $("#online-users").show();
          } else if (message['logout']) {
            $("#online-users").hide();
          }
        } if (message['online-users'] &&
              message['online-users'].constructor.toString().indexOf('Array') != -1) {
          $("#online-users > ul").html('<li>'+message['online-users'].join('</li><li>')+'</li>');
        } else {
          console.log(message['text']);
        }
      };
    }
  };

  $(document).ready(function () {

    connect();

    $("input#login").click(function () {
      conn.send(JSON.stringify({"uid": $("input#uid").val()}));
    });

    $("input#logout").click(function () {
      conn.send('{"logout": "logout"}');
    });
  });
  </script>
</head>
<body>
  <h1>acani</h1>
  <h2>Meet people nearby with similar interests</h2>
  <p id="feedback">Please Login Below</p>
  <input id="uid" type="text"/><input id="login" type="button" value="login"/>
  <input id="logout" type="button" value="logout"/>
  <div id="online-users">
    <h3>Online Users</h3>
    <ul></ul>
  </div>

  <p>To send messages to the iPhone, open up console and run:</p>
  <pre>
    conn.send(JSON.stringify({"uid":"bob"})); // login
  
    // send msg to Matt's iPhone. (Get the appropriate value for to_uid_public
    // from the stdout of the node server after running the iPhone app.)
    conn.send(JSON.stringify({
      "timestamp":~~(Date.now()/1000), // time in seconds since meridian
      "channel":"35b653edcd8ea8c7c6a5245a69073f34e5fc432900a195f91578676c8fb6519e_81b637d8fcd2c6da6359e6963113a1170de795e4b725b84d1e0b4cfd9ec58ce9",
      "sender":"bob_public_id",
      "text":"Hello World!",
      "to_uid_public":"35b653edcd8ea8c7c6a5245a69073f34e5fc432900a195f91578676c8fb6519e"
    }));
  </pre>
</body>
</html>
